@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <link href="~/Content/Site.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="~/Scripts/knockout-3.5.1.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <title>Login</title>
</head>
<body>
    <header>
        <div class="container body-content">
            <nav class="navbar navbar-expand-lg fixed-top" style="top: 0px; background-color: rgb(245 245 245); box-shadow: 0px 0px 8px 0px; color: #3fbaee ">
                <div class="container-fluid sticky-top fixed-top col-lg-6 col-12 col-md-10" style="height: 60px">
                    <a class="navbar-brand fs-4" href="/Adm/Index" style="margin-left: 30px; transform: translateY(-2px)">Carteira Digital</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNavDropdown">
                        <ul class="navbar-nav d-flex col-10 justify-content-around">
                            <li class="nav-item dropdown fs-5">
                                <a class="nav-link" href="/Adm/Relatorio" onclick="return PageCheck()" role="button" style="padding-left: 30px">
                                    Relatório
                                </a>
                            </li>
                            <li class="nav-item fs-5">
                                <a class="nav-link n" onclick="return PageCheck()" href="/Adm/Movimentacao">Movimentação</a>
                            </li>
                            <li class="nav-item fs-5">
                                <a class="nav-link" href="#">Adm - <span data-bind="text: Nome"></span></a>
                            </li>
                        </ul>
                        <div class="col-12 text-center">
                            <a class="nav-link fs-5" onclick="{Sair()}" href="#" style="color: red">Sair</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <div class="container text-center" style="margin-top: 70px;">
        <div style="margin: 15px">
            <a class="navbar-brand fs-4">Pessoas Cadastradas</a>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">Nome</th>
                    <th scope="col">Email</th>
                    <th scope="col">Salario</th>
                    <th scope="col">Limite</th>
                    <th scope="col">Minimo</th>
                    <th scope="col">Saldo</th>
                    <th scope="col">#</th>
                </tr>
            </thead>
            <tbody id="Tabela">
            </tbody>
        </table>
    </div>
    <script src="~/Scripts/jquery-3.4.1.js"></script>
    <script src="~/Scripts/knockout-3.5.1.js"></script>
    <script type="text/javascript">
        function PageCheck() {
            if (sessionStorage.getItem("Id") == null) {
                alert("Selecione um usuário")
                return false
            } else {
                return true
            }
       }


        if (localStorage.getItem("Id") != 3) {
            localStorage.clear()
            window.location.href = "/Login/Index"
        }
        function Sair() {
            localStorage.clear()
            window.location.href = "/Login/Index"
        }





        var DATA;
        $.ajax({
            async: false,
            type: "POST",
            url: "/Repositorio/getAllUser",
            content: "application/json; charset=utf-8",
            dataType: "json",
            data: {},
            success: function (Response) {
                DATA = Response
            },
            error: function () {
                alert("error");
            }
        });
        console.log(DATA)
        Render(DATA)
        function Render(Res) {
            var ResLis = Res.reverse()
            for (var i in Res) {
                var Id = Res[i].PES_ID
                var Desc = Res[i].Descricao
                $("#Tabela").add('<tr id=' + Res[i].PES_ID + '><th scope="row">' + Res[i].PES_ID + '</th></tr>').appendTo($("#Tabela"));
                $(document.getElementById(Id)).add('<td>' + Res[i].PES_NOME + '</td>').appendTo(document.getElementById(Id));
                $(document.getElementById(Id)).add('<td>' + Res[i].PES_EMAIL + '</td>').appendTo(document.getElementById(Id));
                $(document.getElementById(Id)).add('<td> R$' + Res[i].PES_SALARIO + '</td>').appendTo(document.getElementById(Id));
                $(document.getElementById(Id)).add('<td> R$' + Res[i].PES_LIMITE + '</td>').appendTo(document.getElementById(Id));
                $(document.getElementById(Id)).add('<td> R$' + Res[i].PES_MINIMO + '</td>').appendTo(document.getElementById(Id));
                $(document.getElementById(Id)).add('<td> R$' + Res[i].PES_SALDO + '</td>').appendTo(document.getElementById(Id));
                $(document.getElementById(Id)).add('<th><button id="'+"BTN"+Res[i].PES_ID+'" onclick="{Selecionar(this.id)}" class="btn btn-default">Selecionar</button></th>').appendTo(document.getElementById(Id));
            }

        }
        var DATA;
        function Selecionar(IdT) {
            console.log(IdT)
            var Id = IdT.split("BTN")[1]
            console.log(Id)
            sessionStorage.setItem("Id", Id)
            $.ajax({
                async: false,
                type: "POST",
                url: "/Repositorio/getNome",
                content: "application/json; charset=utf-8",
                dataType: "json",
                data: { Id: Id },
                success: function (Response) {
                    DATA = Response
                    Movimento.Nome(DATA)
                    sessionStorage.setItem("Nome", DATA)
                },
                error: function () {
                    alert("error");
                }
            });
        }
        function movimentacao(Nome) {
            this.Nome = Nome
        }
        function movimentacaoViewModel(prop) {
            this.Nome = ko.observable(prop.Nome);
            
        }
        var prop = new movimentacao("", "")
        var Movimento = new movimentacaoViewModel(prop)
        Movimento.Nome(sessionStorage.getItem("Nome"))
        ko.applyBindings(Movimento);

    </script>




</body>
</html>
