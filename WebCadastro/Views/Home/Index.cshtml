

<div class="container-fluid text-center" style="margin-top: 50px;">
    <div style="margin: 30px">
        <a class="fs-4 text-decoration-none navbar-brand" style="margin: 50px">Saldo atual: R$<span data-bind="text: Saldo"></span></a>
    </div>
    <div>
        <a class="navbar-brand fs-4">Últimas movimentações</a>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Desc</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="border:none; border-style:none;"></button>
                    </div>
                    <div class="modal-body">
                        <p id="modalDesc"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Número</th>
                    <th scope="col">Data</th>
                    <th scope="col">Tipo (E/S)</th>
                    <th scope="col">Valor</th>
                    <th scope="col">Saldo</th>
                </tr>
            </thead>
            <tbody id="Tabela">
            </tbody>
        </table>
    </div>
</div>
<script src="~/Scripts/jquery-3.4.1.js"></script>
<script type="text/javascript">




    var Id = localStorage.getItem("Id")
    $.ajax({
        type: "POST",
        url: "/Repositorio/UltimasMovimentacoes",
        content: "application/json; charset=utf-8",
        dataType: "json",
        data: {
            Id: Id
        },
        success: function (Res) {
            Render(Res)
        },
        error: function () {
            alert("error");
        }
    });
    function Render(Res) {
        var ResSor = Res.sort((x, i) => parseInt(x.Data.split("(")[1].split(")")[0]) - parseInt(i.Data.split("(")[1].split(")")[0]))
        var ResLis = Res.reverse()
        var Tabela = document.getElementById("Tabela")
        for (var i in Res) {
            
            var Id = Res[i].Numero
            var Data0 = Res[i].Data.split("(")[1]
            var Data1 = Data0.split(")")[0]
            console.log(parseInt(Data1))
            var Data = new Date(parseInt(Data1)).toLocaleDateString()

            var ValorStr = Res[i].Valor.replace(",",".")
            var ValorFlt = parseFloat(ValorStr)
            var Valor = Math.floor(ValorFlt*1000)/1000

            var SaldoStr = Res[i].Saldo.replace(",", ".")
            var SaldoFlt = parseFloat(SaldoStr).toFixed(3)
            var Saldo = Math.floor(SaldoFlt * 1000) / 1000

            var Desc = Res[i].Descricao
            $("#Tabela").add('<tr id=' + Id + '><th scope="row">' + Id + '</th></tr>').appendTo($("#Tabela"));
            $(document.getElementById(Id)).add('<td>' + Data + '</td>').appendTo(document.getElementById(Id));
            $(document.getElementById(Id)).add('<td>' + Res[i].Tipo + '</td>').appendTo(document.getElementById(Id));
            $(document.getElementById(Id)).add('<td> R$' + Valor + '</td>').appendTo(document.getElementById(Id));
            $(document.getElementById(Id)).add('<td> R$' + Saldo + '</td>').appendTo(document.getElementById(Id));
        }

    }


    $.ajax({
        type: "POST",
        url: "/Repositorio/getSaldo",
        content: "application/json; charset=utf-8",
        dataType: "json",
        data: {
            Id: Id
        },
        success: function (Saldo) {
            localStorage.setItem("Saldo", Saldo)
        },
        error: function () {
            alert("error");
        }
    });
    function openModal(Desc) {
        document.getElementById("modalDesc").innerHTML = Desc

    }

    function movimentacao(Saldo, Usuario) {
        this.Saldo = Saldo
        this.Usuario = Usuario
    }
    function movimentacaoViewModel(prop) {
        this.Saldo = ko.observable(prop.Saldo);
        this.Usuario = ko.observable(localStorage.getItem("Nome"))
    }
    var prop = new movimentacao("", "")
    var Movimento = new movimentacaoViewModel(prop)
    Movimento.Saldo(localStorage.getItem("Saldo"))
    ko.applyBindings(Movimento);

</script>